---
title: "DATA 605 HW 5"
author: "Magnus Skonberg"
date: "`r Sys.Date()`"
output: 
    html_document:
        toc: true
        toc_float: true
        number_sections: false
        theme: cerulean
        highlight: tango
        font-family: "Arial"
---

```{r load-packages, include=FALSE}
library(tidyverse)
library(openintro)
library(dplyr)
library(tidyr)
library(RCurl)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Background

The purpose of this assignment is to *tidy and transform data*. The dataset of interest describes arrival delays for two airlines across five destinations and our task is to: 

(1) Create a .csv file in a "wide" structure.
(2) Read this .csv and use tidyr and dplyr to tidy and transform.
(3) Analyze arrival delays between the airlines.
(4) Provide the .rmd file, rpubs link, and descriptions of steps taken.

--------------------------------------------------------------------------------

\clearpage

### (1) Create a .csv.

A wide format .csv is created per assignment description and [uploaded to github.](https://github.com/Magnus-PS/CUNY-SPS-DATA-607/blob/Assignment-5/Wcoast_airline_comp.csv)

With the .csv available on github, we shift to reading from this file *prior to* tidying and transforming the data therein.

### (2) Read, tidy, and transform.

We read the .csv (in its raw form) from github and store corresponding data in a variable named "data" (I know ... very creative).

```{r}
#Get URL, read .csv (in raw form) from github, and put into tabular form
url <- getURL("https://raw.githubusercontent.com/Magnus-PS/CUNY-SPS-DATA-607/Assignment-5/Wcoast_airline_comp.csv")
data <- read.csv(text = url)
data <- tbl_df(data)

#Show what we're working with:
data

```

Once we've read from .csv and stored our data, we shift to tidying and transforming the data therein.

To start, we tidy:

```{r}
#Tidy / shape our data (using tidyr)

##Provide fitting column names for the 1st and 2nd column
names(data)[names(data) == "X"] <- "Airline"
names(data)[names(data) == "X.1"] <- "Status"

##Remove rows with "NA" from dataset
data <- na.omit(data)

##Make observations from variables using gather()
##This is also when we convert from a 'wide' to 'long' format
data_long <- gather(data, "Airport", "n", 3:7, factor_key=TRUE)


##Initialize counter then fill empty Airline elements via for loop
n <- 2 

for (n in c(2,6,10,14,18)){
    data_long$Airline[n] <- "ALASKA"
    data_long$Airline[n+2] <- "AM WEST"
    n <- n+4
}

##Make variables from observations using spread()
data_long <- spread(data_long, "Status", "n")
data_long

```

What started as a *less clear* 5x7 'wide' table ("data") is now a  *tidy* 4x10 'long' table ("data_long"). 

With tidying complete, we move on to transforming our data. We'll make use of dplyr() to transform data and perform mathematical calculations to solve for our variables. After this point, we should have all we need to plot and *clearly* observe the difference in delays between the two airlines.

We can identify our high-level variables of interest as:
(1) What airline has the lowest overall probability of arrival delay?
(2) At each airport, which airline has the lower probability of arrival delay?

To calculate (1), we can take the total flights delayed and on time per airline, sum them together, and observe the probability of delay for each airline.

To calculate (2), we can perform the same operations, just this time we will select for the airport first and then the airline.

```{r}
#Transform the data: dplyr

##Compute the probability of an Alaska flight arriving on time
ak <- filter(data_long, Airline == "ALASKA")
ak_on_time <- sum(ak$`on time`) / (sum(ak$delayed) + sum(ak$`on time`))
ak_on_time

#Compute the probability of an AM West flight arriving on time
aw_flts <- filter(data_long, Airline == "AM WEST")
aw_on_time <- sum(aw_flts$`on time`) / (sum(aw_flts$delayed) + sum(aw_flts$`on time`))
aw_on_time

```
**AM West has a better total on time probability.**

Thus it would be the better airline to fly with if the passenger in question wanted to arrive on time and didn't have access to specific airport data. 

But we do have access to specific airport data ...

Let's explore: which airline is better to fly with (greater on time probability) per airport?

```{r}

##Los Angeles - Alaskan Air
la_ak <- filter(data_long, Airport == "Los.Angeles" & Airline == "ALASKA")
la_ak_on_time <- sum(la_ak$`on time`) / (sum(la_ak$delayed) + sum(la_ak$`on time`))
la_ak_on_time

##Los Angeles - AM West Air
la_aw <- filter(data_long, Airport == "Los.Angeles" & Airline == "AM WEST")
la_aw_on_time <- sum(la_aw$`on time`) / (sum(la_aw$delayed) + sum(la_aw$`on time`))
la_aw_on_time



#Compute the probability of an AM West flight arriving on time
aw_flts <- filter(data_long, Airline == "AM WEST")
aw_on_time <- sum(aw_flts$`on time`) / (sum(aw_flts$delayed) + sum(aw_flts$`on time`))
aw_on_time

```

### (3) Analyze and compare.

Compare arrival delays between the two airlines.

```{r}
#associated r code
```
