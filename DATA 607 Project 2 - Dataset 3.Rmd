---
title: "DATA 607 Project 2 - Dataset 3"
author: "Magnus Skonberg"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: no
    theme: cerulean
    highlight: tango
    font-family: Arial
  pdf_document:
    toc: yes
---

```{r load-packages, include=FALSE}
library(tidyverse)
library(openintro)
library(dplyr)
library(tidyr)
library(RCurl)
library(ggplot2)
library(reshape2)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Background

The purpose of this assignment is to *tidy and transform data*. The dataset of interest describes **subway ridership from 2013 to 2018 for Brooklyn, the Bronx, Manhattan and Queens** and our task is to: 

(1) Create a .csv file in a "wide" structure.
(2) Read this .csv and use tidyr and dplyr to tidy and transform.
(3) Analyze which borough had the largest v smallest drop in subway ridership from 2013 to 2018.
(4) Provide the .rmd file, rpubs link, and descriptions of steps taken.

--------------------------------------------------------------------------------

\clearpage

### (1) Create a .csv

The original data set was downloaded from the NYC MTA's website [available here.](http://web.mta.info/nyct/facts/ridership/ridership_sub_annual.htm) **Citation at bottom of page.**

If you were to scroll down in this set, you would observe the total ridership for each borough from 2013 to 2018, this was the data we concerned ourselves with.

A wide format .csv was created per assignment description and [uploaded to github.](https://github.com/Magnus-PS/CUNY-SPS-DATA-607/blob/Project-2/subway_riders.csv)

With the .csv available on github, we shift to reading from this file *prior to* tidying and transforming the data therein.

### (2) Read and tidy

We read the .csv (in its raw form) from github and store corresponding data in a variable named "data" (I know ... very creative).

```{r}
#Get URL, read .csv (in raw form) from github, and put into tabular form
url <- getURL("https://raw.githubusercontent.com/Magnus-PS/CUNY-SPS-DATA-607/Project-2/subway_riders.csv")
data <- read.csv(text = url)
data <- tbl_df(data)

#Show what we're working with:
data

```
Once we've read from .csv and stored our data, we shift to tidying and transforming the data therein.

```{r}

##Remove the empty 8th column and the 2nd - 7th columns
data_chosen <- select(data, c(Borough, X2013, X2018))

#Remove the "X" from the year columns
names(data_chosen)[names(data_chosen) == "X2013"] <- "2013"
names(data_chosen)[names(data_chosen) == "X2018"] <- "2018"

##Make observations from variables using gather()
##This is also when we convert from a 'wide' to 'long' format
data_long <- gather(data_chosen, "Year", "Ridership", 2:3, factor_key=TRUE)

#Delete empty row values
data_long <- subset(data_long, data_long$Borough != "",
select=c(Borough, Year, Ridership))

##Sort 'Borough' column alphabetically
data_long <- data_long[order(data_long$Borough),]

data_long

qplot(x=Borough, y=Ridership, data=data_long, col=Year, main=" Ridership v Borough 2013 to 2018", xlab="Borough", ylab="Ridership")

```

Badabing-badaboom. We got ourselves a long dataset.

What started as a *less clear* 5x8 'wide' table ("data") is now a  *tidy* 5x3 'long' table ("data_chosen") with a corresponding plot that shows that **every borough had a drop in ridership from 2013 to 2018.** 

### (3) Transform and analyze

What we couldn't observe in the plot above is which borough had the largest v smallest drop in ridership. This is what we were hoping to analyze and thus, we'll lean on transformation and mathematics to draw a clearer picture. More specifically, we can use the following equation:

*((Ridership (2018) - Ridership (2013)) / (Ridership (2013)) x 100)*

Doing so should paint a *clearer* picture of which borough had the largest v smallest drop in ridership.

```{r}
#Remove ","s from Ridership column
data_long$Ridership <- gsub(",","",data_long$Ridership)

#Convert Ridership column to numeric
data_long$Ridership <- as.numeric(as.character(data_long$Ridership))

##Compute the percent change in ridership for the Bronx
bx_r <- filter(data_long, Borough == "Bronx")
bx_chg <- as.numeric(round(((bx_r[2,3] - bx_r[1,3]) / bx_r[1,3]) * 100, 2))

##Compute the percent change in ridership for Brooklyn
bk_r <- filter(data_long, Borough == "Brooklyn")
bk_chg <- as.numeric(round(((bk_r[2,3] - bk_r[1,3]) / bk_r[1,3]) * 100, 2))

##Compute the percent change in ridership for Manhattan
m_r <- filter(data_long, Borough == "Manhattan")
m_chg <- as.numeric(round(((m_r[2,3] - m_r[1,3]) / m_r[1,3]) * 100, 2))

##Compute the percent change in ridership for Queens
q_r <- filter(data_long, Borough == "Queens")
q_chg <- as.numeric(round(((q_r[2,3] - q_r[1,3]) / q_r[1,3]) * 100, 2))

#Now add a column to the table for these calculated values
data_long$Chg <- c(0, bx_chg, 0, bk_chg, 0, m_chg, 0, q_chg)
data_long

```

Now that we've performed our essential transformations and calculations, and brought our data into the desired form, the last step is to provide a plot that paints the picture clear as day.

Based on what we're looking for, a barplot (with displayed values) will do the trick:

```{r}
#Plot the change in ridership for each borough
rider_chg <- filter(data_long, Year == "2018")
barplot(rider_chg$Chg, beside=TRUE, main = "Change in ridership from 2013 to 2019 v NYC Borough", xlab = "Borough", ylab = "Chg in Ridership (%)", ylim = c(-7, 0), names.arg = c("Bronx", "Brooklyn", "Manhattan", "Queens"), col=c("#F75252", "#F75252", "#F75252", "#F75252", "#F75252"))

text(0.7, -6.2, as.character(bx_chg), col = "white")
text(2, -0.25, as.character(bk_chg), col = "white")
text(3.1, -0.25, as.character(m_chg), col = "white")
text(4.3, -4.3, as.character(q_chg), col = "white")
                      
```

From this graphic, we observe that all boroughs saw a drop in ridership, 2 boroughs (Brooklyn and Manhattan) saw a slight drop in ridership , 2 boroughs (Queens and the Bronx) saw a significant drop in ridership, **the Bronx saw the greatest drop in ridership, and Manhattan saw the smallest drop in ridership.**

Regarding subway ridership the picture is clear as day: **New Yorkers road the subway less in 2018 than they did in 2013 (especially in the Bronx).**

### (4) Conclude

Fewer New Yorkers are riding the subway and I would have thought the opposite. It raises a lot of questions:

-are the Bronx and Queens less public transport friendly?
-are trains less reliable in the Bronx and Queens?
-did more people move to Manhattan and Brooklyn during these years than to the Bronx and Queens?
-are more people riding their bikes instead of taking the train?
-were less people riding the train because the economy was good, they had spending cash and thus they taxid, Ubered, or bought a car?

and the list could go on ...

Coming to this conclusion was paradigm-shifting. I would have *assumed* the opposite. 

With more people moving to the city from 2013 - 2018 and more talk of "living green", I would have thought more people would use public transport, but that's not the case. The data tells a different story and raises some pretty interesting questions. 

--------------------------------------------------------------------------------

\clearpage

**Data citation**
The Metropolitan Transportation Authority. (2019). Annual Subway Ridership [Data file]. Retrieved from http://web.mta.info/nyct/facts/ridership/ridership_sub_annual.htm